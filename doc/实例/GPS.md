# 启用GPS功能

- GPS功能目前支持Air530/800 /801/868/820 以及相应的开发板。

- 启用GPS功能会占用1个串口，另外一个串口依旧可以配置DTU的各种功能

- GPS 报文JSON定义
  - 信息 = [是否有效,时间戳,经度,纬度,海拔,方位角,速度,载噪比,定位卫星]
  - 设备 = [是否打开，震动，开锁，点火，充电，剪线，外电电压，电池电压，GPRS信号值]

```
  {"msg":[true,1547272725,1136037366,348581216,114,354,1,43,4]}
  {"sta":[true,false,false,false,false,false,65535,4101,11]}
  ```

- GPS报文HEX定义（报文长度固定大端）
- msg报文0xAA开头，设备信息报文0x55开头
  - [信息 | 是否有效|时间戳|经度|纬度|海拔|方位角|速度|载噪比|定位卫星]
  - [1B   |     1B| 4B  | 4B| 4B |2B | 2B  | 1B | 1B | 1B    ] = 21 Byte
  ```
  [AA 01 5C399812 43B68DF6 14C6ED60 0016 001E 0F 32 0E] 
  ```
  - [设备 |是否打开|震动|开锁|点火|充电|剪线|外电电压|电池电压|GPRS信号值]
  - [ 1B |  1B  | 1B | 1B| 1B | 1B| 1B |4B    |2B     |1B  ] = 13 byte
  ```
  [55 00 00 00 00 00 00 00006A10 1011 15]
  ```

## GPS的GPIO配置

- demo: "config, gps, pio, pio8 ,pio9, pio10, 0, 16"

| 字段    | 值          | 含义                                                       |
| ------- | ----------- | ---------------------------------------------------------- |
| config  | config      | 配置指令标识                                               |
| id      | gps         | 通道编号gps表示配置gps                                     |
| type    | pio         | GPS 的配置 GPIO 的标志位                                   |
| netdrdy | pio0-pio128 | GPS 定位成功指示灯 GPIO 编号，例如 GPIO_3  就填 pio3，下同 |
| vib     | pio0-pio128 | 振动传感器信号输入GPIO编号                                 |
| acc     | pio0-pio128 | ACC开锁信号输入GPIO编号注意ACC信号电压很高要用分压电阻     |
| chg     | pio0-pio128 | 内置锂电池充电状态输入GPIO编号,可为空                      |
| adc     | 0 or 1      | 检测VCC的ADC通道编号，默认0                                |
| ratio   | 1-50        | VCC/1.8V  + 1的值，是值ADC采集电压和VCC实际电压的比值      |

### GPS 的报文配置

- demo: "config, gps, fun, 2, 115200, 0, 5, 1, json, 100, ; ,60" 

| 字段     | 值              | 含义                                                         |
| -------- | --------------- | ------------------------------------------------------------ |
| config   | config          | 配置指令标识                                                 |
| id       | gps             | 通道编号gps表示配置gps                                       |
| type     | fun             | GPS 的配置 fun参数 的标志位                                  |
| 串口ID   | 1 or 2          | GPS 启用的串口波特率，注意不要和socket通道同时启用           |
| 波特率   | 115200          | 9600-115200，注意和模块的GPS实际波特率一致                   |
| 功耗模式 | 0 or 2 or 8     | GPS工作模式: 正常，低功耗，低功耗跟踪模式                    |
| 采集间隔 | 1-600           | 单位秒，多久采集并记录一次GPS报文                            |
| 采集方式 | 0 or 1          | 0 布防采集（触发上报），1持续采集                            |
| 报文格式 | json or hex     | 设备信息和GPS定位信息上报的报文格式，支持JSON和HEX           |
| 缓冲发送 | 0 - 1000        | 0 表示不缓冲，采集后立刻上报，其他表示先加入缓冲区，然后1次上报 |
| 分隔符   | 除,外的可见字符 | 启用缓冲发送，用来分割报文的标记                             |
| 状态间隔 | 0-1440          | 单位分钟，设备信息报文上报频率，0为不上报                    |
| 上报通道 | 上报网络通道    | 捆绑用于GPS上报的网络通道id,串口和GPS可以公用1个socket/mqtt/http 通道 |